atlas-paket
===========
[![Gradle Plugin ID](https://img.shields.io/badge/gradle-net.wooga.paket-brightgreen.svg?style=flat-square)](https://plugins.gradle.org/plugin/net.wooga.paket)
[![Build Status](https://img.shields.io/travis/wooga/atlas-paket/master.svg?style=flat-square)](https://travis-ci.org/wooga/atlas-paket)
[![Coveralls Status](https://img.shields.io/coveralls/wooga/atlas-paket/master.svg?style=flat-square)](https://coveralls.io/github/wooga/atlas-paket?branch=master)
[![Apache 2.0](https://img.shields.io/badge/license-Apache%202-blue.svg?style=flat-square)](https://raw.githubusercontent.com/wooga/atlas-paket/master/LICENSE)
[![GitHub tag](https://img.shields.io/github/tag/wooga/atlas-paket.svg?style=flat-square)]()
[![GitHub release](https://img.shields.io/github/release/wooga/atlas-paket.svg?style=flat-square)]()

This plugin provides tasks for retrieving and publishing [Paket][paket] packages in [gradle][gradle]. It downloads [`paket.exe`][paket_exe] via the [`paket.bootstrapper.exe`][paket_bootstrapper] and runs both with `mono/.Net`. This plugins helps to build and package .Net projects with gradle. 

# Applying the plugin

**build.gradle**
```groovy
plugins {
    id 'net.wooga.paket' version '0.6.0'
}
```
-or-
```groovy
plugins {
    id 'net.wooga.paket-get' version '0.6.0'
    id 'net.wooga.paket-pack' version '0.6.0'
    id 'net.wooga.paket-publish' version '0.6.0'
    id 'net.wooga.paket-unity' version '0.6.0'
}
```

#System Requirements

### Unix
mono > 5.x

### Windows
.Net > 5.x

# Usage
## Paket-Base
The invisible `paket-base` plugin contains the basic functionality and tasks to run all other `paket-*` plugins. It generates the `paketBootstrap` which initializes the build environment to work with `Paket`. It also defines a custom configuration that is used by some the other `paket-*` plugins.

### Configuration
The plugin defines a custom configuration named `nupkg`. It will hold artifacts generated by `paket-pack` mainly `.nupkg` packages.

### Tasks
The `paket-base` plugin add a number of tasks to your project

| Task name      | Depends on     | Type                                           | Description |
| -------------- | -------------- | ---------------------------------------------- | ----------- |
| paketInit      |                | `wooga.gradle.paket.get.tasks.PaketInit`       | Creates empty `paket.dependencies` file and calls `paketBootstrap` |
| paketBootstrap |                | `wooga.gradle.paket.base.tasks.PaketBootstrap` | Downloads `paket.bootstrapper.exe` and initializes `paket.exe`     |

## Paket-Get
The `paket-get` plugin will apply the `paket-base` plugin and all it's tasks.
If you only want to retrieve dependencies through paket in your project apply this plugin. It will check for a `paket.dependencies` file in your root. The tasks provided will skip with `NO-SOURCES` when there is no `paket.dependencies` file.
Check out the documentation of `Paket` to learn more.

### Tasks
The `paket-get` plugin adds a number of tasks to your project. These are mainly commandline wrappers for the corresponding [Paket][paket] task.

| Task name      | Depends on     | Type                                           | Description |
| -------------- | -------------- | ---------------------------------------------- | ----------- |
| paketInstall   | paketBootstrap | `wooga.gradle.paket.get.tasks.PaketInstall`    | Download the dependencies specified by the paket.dependencies or paket.lock file into the packages/ directory and update projects.|
| paketRestore   | paketBootstrap | `wooga.gradle.paket.get.tasks.PaketRestore`    | Download the dependencies specified by the paket.lock file into the `packages/` directory. |
| paketUpdate    | paketBootstrap | `wooga.gradle.paket.get.tasks.PaketUpdate`     | Update one or all dependencies to their latest version and update projects |

## Paket-Unity
This plugin allows to use the extension [paket.unity3d](http://wooga.github.io/Paket.Unity3D/) together with `paket-get`

### Tasks
The `paket-unity` plugin adds a few tasks that will hook themself onto `paket-get`

| Task name           | Depends on          | Type                                                | Description |
| ------------------- | ------------------- | --------------------------------------------------- | ----------- |
| paketUnityBootstrap | paketBootstrap      | `wooga.gradle.paket.unity.task.PaketUnityBootstrap` | Downloads `paket.unity3d.bootstrapper.exe` and initializes `paket.unity3d.exe`
| paketUnityInstall   | paketUnityBootstrap | `wooga.gradle.paket.unity.tasks.PaketUnityInstall`  | Installs the dependencies into the Unity3d project

The `paketUnityInstall` will configure itself as a [`finalizedBy`][gradle_finalizedBy] task for `paketInstall`, `paketRestore and `paketUpdate`. There is no need to call this task manually. The task also gets skipped when no `paket.unity3d.references` file can be found anywhere in the project directory tree.

## Paket-Pack
The `paket-pack` plugin allows you to package `.nugkg` packages from [`paket.template`][paket_template] files.
It will apply the plugins `base` and `paket-base`.

### Tasks
The plugin will generate a package task based on the package id inside the [`paket.template`][paket_template]  file

| Task name             | Depends on          | Type                                              | Description |
| --------------------- | ------------------- | ------------------------------------------------- | ----------- |
| paketPack-*packageId* | paketBootstrap      | `wooga.gradle.paket.pack.tasks.PaketPack`         | Packs the [`paket.template`][paket_template]  file into a `nupkg` package |

The plugin checks if the `paket-get` plugin is applied. If so, it will make all `PaketPack` tasks [`dependOn`][gradle_dependsOn] `paketInstall`.

### Artifacts
When you apply the `paket-pack` plugin your project will produce artifacts in the `nupkg` configuration.
You can access these artifacts from subprojects or inside your build.gradle

**build.gradle**

```
task(copyToSomeWhere, type:Copy) {
    from {configurations.nupkg}
    into 'custom/output'
}

```

## Paket-Publish
This plugin allows to publish `.nupkg` packages packed with `paket-pack` to nuget repositories.
It will apply the plugins `publishing` and `paket-base` plugin.

### publish repositories
Before you can use and publish `npkg` packages you need to configure one or more publish repositories. The `paket-publish` plugin will hook itself into the base publishing plugin of gradle.

**build.gradle**

```gradle
plugins {
    id "net.wooga.paket-publish" version "0.6.0"
}

publishing {
    repositories {
        nuget {
            name "internal name of the repository"
            url "url to repository"
            apiKey = "optional api key"
        }
    }
}
```

By default [`Paket`][paket_push] will try to use the `nugetkey` environment variable for authentication. If you specify the `apikey` value it will be passed to the [`paket push`][paket_push] command.

The plugin will hook itself into the publishing lifecycle and will make the `publish` task depending on `publish*publishRepositoryName*`. This allows to publish multiple packages to the same repository with one task.

**build.gradle**
```gradle
plugins {
    id "net.wooga.paket-publish" version "0.6.0"
}

publishing {
    ...
}

paketPublish {
    publishRepositoryName = "snapshot" // defaults to "nuget"
}

```

The value of `publishRepositoryName` can also be set via gradle parameter `paket.publish.repository`

**terminal**

```
$./gradlew -Ppaket.publish.repository=snapshot publish

```


### Tasks

The plugin creates a number of tasks based on the configurated publishing repositories and artifacts inside the project.

| Task name                           | Depends on                           | Type                                              | Description |
| ----------------------------------- | ------------------------------------ | ------------------------------------------------- | ----------- |
| publish-*packageId*                 | the `npkg` artifact, paketBootstrap  | `wooga.gradle.paket.publish.tasks.PaketPush`      | publishes one artifact from the `npgk` configuration based on the `packageId` to the default publishing repository
| publish*repositoryName*-*packageId* | the `npkg` artifact, paketBootstrap  | `wooga.gradle.paket.publish.tasks.PaketPush`      | publishes one artifact from the `npgk` configuration based on the `packageId` to the repository named: `repositoryName`
| publish*repositoryName*             | all `nppg` artifacts, paketBootstrap | `DefaultTask`                                     | publishes all artifacts to the publishing repository named: `repositoryName`


Gradle and Java Compatibility
=============================

Built with Oracle JDK7
Tested with Oracle JDK8

| Gradle Version | Works |
| :------------: | :---: |
| 3.4.1          | yes   |
| 3.5            | yes   |

LICENSE
=======

Copyright 2017 Wooga GmbH

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

<http://www.apache.org/licenses/LICENSE-2.0>

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

<!-- Links -->
[paket_template]:       https://fsprojects.github.io/Paket/template-files.html "paket template file"
[paket]:                https://fsprojects.github.io/Paket/ "Paket"
[paket_exe]:            https://github.com/fsprojects/Paket/releases/download/5.1.8/paket.exe
[paket_push]:           https://fsprojects.github.io/Paket/paket-push.html
[paket_bootstrapper]:   https://github.com/fsprojects/Paket/releases/download/5.1.8/paket.bootstrapper.exe
[paket_unity3d]:        http://wooga.github.io/Paket.Unity3D/ "Paket.Unity3d"
[gradle]:               https://gradle.org/ "Gradle"
[gradle_finalizedBy]:   https://docs.gradle.org/3.5/dsl/org.gradle.api.Task.html#org.gradle.api.Task:finalizedBy
[gradle_dependsOn]:     https://docs.gradle.org/3.5/dsl/org.gradle.api.Task.html#org.gradle.api.Task:dependsOn

